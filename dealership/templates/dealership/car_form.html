{% extends "base.html" %}
{% block content %}

<style>
  :root{
    --text:#0f172a;
    --muted:#475569;
    --border:rgba(15,23,42,.10);
    --primary:#2f6fed;
    --primary-2:#1d4ed8;
    --danger:#ef4444;
    --success:#10b981;

    --shadow:0 18px 50px rgba(2,6,23,.12);
    --shadow-soft:0 12px 30px rgba(2,6,23,.08);

    --radius-xl:26px;
    --radius-lg:18px;
    --radius-md:14px;

    --ease:cubic-bezier(.2,.8,.2,1);
  }

  .form-page{
    display:grid;
    grid-template-columns: 1.1fr .9fr;
    gap: 14px;
    align-items:start;
  }
  @media (max-width: 980px){
    .form-page{ grid-template-columns: 1fr; }
  }

  .panel{
    background: rgba(255,255,255,.88);
    border: 1px solid var(--border);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow);
    overflow:hidden;
    transform: translateY(10px);
    opacity: 0;
    transition: transform .9s var(--ease), opacity .9s var(--ease);
  }
  .panel.is-in{ transform:none; opacity:1; }

  .panel-head{
    padding: 18px 18px 14px;
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap: 12px;
    border-bottom: 1px solid rgba(15,23,42,.08);
    background:
      radial-gradient(600px 220px at 10% 0%, rgba(47,111,237,.14), transparent 60%),
      radial-gradient(520px 220px at 100% 0%, rgba(124,58,237,.12), transparent 60%),
      rgba(255,255,255,.75);
    backdrop-filter: blur(10px);
  }

  .title{
    margin:0;
    font-size: 20px;
    letter-spacing:-.02em;
    color: var(--text);
    font-weight: 1000;
  }
  .subtitle{
    margin: 6px 0 0;
    color: var(--muted);
    font-weight: 700;
    font-size: 13.5px;
    line-height: 1.5;
    max-width: 70ch;
  }

  .pill{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding: 8px 10px;
    border-radius: 999px;
    background: rgba(47,111,237,.10);
    border: 1px solid rgba(47,111,237,.18);
    color: #1e3a8a;
    font-weight: 900;
    font-size: 12px;
    white-space: nowrap;
  }

  .panel-body{
    padding: 18px;
  }

  /* Django form styling */
  form p{
    margin: 0 0 12px;
  }

  form label{
    display:block;
    margin: 0 0 6px;
    color: var(--text);
    font-weight: 900;
    font-size: 13px;
    letter-spacing: .01em;
  }

  input, select, textarea{
    width:100%;
    border-radius: 14px;
    border: 1px solid var(--border);
    padding: 12px 12px;
    background: rgba(255,255,255,.92);
    color: var(--text);
    font-weight: 800;
    font-size: 14px;
    outline: none;
    transition: box-shadow .25s var(--ease), border-color .25s var(--ease), transform .25s var(--ease);
  }

  textarea{ min-height: 110px; resize: vertical; }

  input:focus, select:focus, textarea:focus{
    border-color: rgba(47,111,237,.35);
    box-shadow: 0 0 0 6px rgba(47,111,237,.10);
    transform: translateY(-1px);
  }

  /* Django errors */
  .errorlist{
    list-style: none;
    padding: 10px 12px;
    margin: 8px 0 12px;
    border-radius: 14px;
    background: rgba(239,68,68,.10);
    border: 1px solid rgba(239,68,68,.18);
    color:#7f1d1d;
    font-weight: 900;
    font-size: 13px;
  }
  .helptext{
    display:block;
    margin-top: 6px;
    color: var(--muted);
    font-weight: 700;
    font-size: 12.5px;
    line-height: 1.45;
  }

  /* buttons */
  .actions{
    display:flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 14px;
    padding-top: 14px;
    border-top: 1px solid rgba(15,23,42,.08);
  }

  .btn{
    display:inline-flex;
    align-items:center;
    gap:10px;
    padding: 11px 14px;
    border-radius: 14px;
    border:1px solid var(--border);
    background: rgba(255,255,255,.92);
    color: var(--text);
    font-weight: 900;
    text-decoration:none;
    box-shadow: 0 12px 26px rgba(2,6,23,.08);
    transition: transform .25s var(--ease), box-shadow .25s var(--ease), border-color .25s var(--ease);
    user-select:none;
    cursor:pointer;
  }
  .btn:hover{
    transform: translateY(-2px);
    box-shadow: 0 18px 40px rgba(2,6,23,.12);
    border-color: rgba(47,111,237,.25);
  }
  .btn:active{ transform: translateY(0) scale(.99); }

  .btn.primary{
    background: linear-gradient(180deg, var(--primary), var(--primary-2));
    border-color: rgba(255,255,255,.35);
    color: #fff;
  }

  .btn .ic{ width:18px;height:18px; display:inline-flex; align-items:center; justify-content:center; }

  /* right side help card */
  .side{
    background: rgba(255,255,255,.86);
    border: 1px solid var(--border);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-soft);
    padding: 18px;
    transform: translateY(12px);
    opacity: 0;
    transition: transform 1s var(--ease), opacity 1s var(--ease);
    transition-delay: .06s;
  }
  .side.is-in{ transform:none; opacity:1; }

  .side h3{
    margin: 0 0 10px;
    color: var(--text);
    font-size: 15px;
    letter-spacing: -.01em;
    font-weight: 1000;
  }

  .tips{
    display:grid;
    gap: 10px;
    margin: 0;
    padding: 0;
    list-style:none;
  }
  .tip{
    border-radius: 16px;
    padding: 12px 12px;
    background: rgba(255,255,255,.90);
    border: 1px solid rgba(15,23,42,.08);
    box-shadow: 0 10px 22px rgba(2,6,23,.06);
    color: var(--muted);
    font-weight: 800;
    line-height: 1.5;
  }
  .tip strong{ color: var(--text); }

  /* compact form layout improvement (turn p into blocks) */
  .panel-body form{
    display:block;
  }

  /* reduced motion */
  @media (prefers-reduced-motion: reduce){
    .panel,.side{ transition:none !important; transform:none !important; opacity:1 !important; }
    input:focus, select:focus, textarea:focus{ transform:none !important; }
  }
</style>

<div class="form-page">
  <!-- MAIN FORM -->
  <section class="panel" id="formPanel">
    <div class="panel-head">
      <div>
        <h2 class="title">Car form</h2>
        <p class="subtitle">
          Add or update vehicle details. Keep prices accurate to ensure profit reports remain reliable.
        </p>
      </div>
      <span class="pill" id="modePill">
        <span aria-hidden="true">üìù</span> Editing
      </span>
    </div>

    <div class="panel-body">
      <form method="post" id="carForm" novalidate>
        {% csrf_token %}
        {{ form.as_p }}

        <div class="actions">
          <button type="submit" class="btn primary">
            <span class="ic" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2Z"></path>
                <path d="M17 21v-8H7v8"></path>
                <path d="M7 3v5h8"></path>
              </svg>
            </span>
            Save
          </button>

          <a class="btn" href="{% url 'dealership:car_list' %}">
            <span class="ic" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M15 18l-6-6 6-6"></path>
              </svg>
            </span>
            Back to list
          </a>

          <span class="pill" style="background: rgba(16,185,129,.10); border-color: rgba(16,185,129,.18); color:#065f46;">
            <span aria-hidden="true">‚úî</span> Auto-styled fields
          </span>
        </div>
      </form>
    </div>
  </section>

  <!-- SIDE INFO -->
  <aside class="side" id="sidePanel">
    <h3>Quick tips</h3>
    <ul class="tips">
      <li class="tip"><strong>Manufacturer</strong> and <strong>Model</strong> should match official naming.</li>
      <li class="tip"><strong>Year</strong> must be a valid production year (e.g., 2018, 2021).</li>
      <li class="tip"><strong>Cost price</strong> is what you paid. <strong>Potential sale price</strong> impacts profit reports.</li>
      <li class="tip">Use the list page to quickly <strong>Edit</strong> or <strong>Delete</strong> records.</li>
    </ul>
  </aside>
</div>

<script>
(function(){
  const formPanel = document.getElementById('formPanel');
  const sidePanel = document.getElementById('sidePanel');
  const modePill = document.getElementById('modePill');

  // Reveal animations
  requestAnimationFrame(()=>{
    formPanel.classList.add('is-in');
    sidePanel.classList.add('is-in');
  });

  // Try to detect Add vs Edit mode (best-effort)
  // If any input already has a value -> likely editing.
  const inputs = Array.from(document.querySelectorAll('#carForm input, #carForm select, #carForm textarea'))
    .filter(el => el.type !== 'hidden' && el.name !== 'csrfmiddlewaretoken');

  const hasAnyValue = inputs.some(el => (el.value || '').trim().length > 0);
  modePill.innerHTML = hasAnyValue
    ? '<span aria-hidden="true">üìù</span> Editing'
    : '<span aria-hidden="true">‚ûï</span> Adding';

  // Light ‚Äúrequired‚Äù hint styling (visual only; Django handles actual validation)
  inputs.forEach(el=>{
    const label = el.closest('p')?.querySelector('label');
    const isRequired = el.hasAttribute('required') || (el.getAttribute('aria-required') === 'true');
    if(label && isRequired){
      label.innerHTML = label.innerHTML.replace(/\s*:\s*$/, '') + ' <span style="color: rgba(239,68,68,.85); font-weight:1000;">*</span>';
    }
  });
})();
</script>

{% endblock %}
